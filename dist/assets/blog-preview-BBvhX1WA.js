import{_ as B,r as b,D as C,o as P,c as g,b as l,w as o,bs as U,V as $,k as N,F as D,f as d,e as S,g as R,h as T,d as i,t as s,q as E,y as H,x as L,G as f,s as z,j as w,i as m,O,J as j,K as A,bt as F,bu as G,bv as q,bw as J,bx as K,by as M,bz as W}from"./index-DNCe_cCi.js";import{V as Q}from"./VSnackbar-ZzpTCICS.js";const X={class:""},Y={class:"text-start text-white"},Z={class:"text-white"},ee={class:"text-white"},ae={class:"ma-4"},te={key:0},oe={key:1},le={__name:"blog-preview",setup(se){const p=O(),_=b(!1),r=b({show:!1,text:"",color:"info"}),e=b({avatarPath:"",author:"",id:"",title:"",date:"",initialHeader:"",initialParagraph:"",coverImageUrl:"",contentItems:[]}),I=u=>u.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,60),k=C(()=>{const u="url('@/assets/hero-background.png')",a=e.value.coverImageUrl;return a?{backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('${a}')`}:{backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), ${u}`}});P(()=>{history.state&&history.state.blogData?(e.value=history.state.blogData,console.log("Blog data loaded from history:",e.value)):console.error("No blog data found in history state")});const V=()=>{p.back()},x=async()=>{_.value=!0;const u=j(A,"blog-posts"),a=I(e.value.title);try{let t=new Date;if(e.value.formattedDate){const c=e.value.formattedDate.replace(/(\d+)(st|nd|rd|th)/,"$1"),h=new Date(c);isNaN(t.getTime())&&(console.warn("Invalid date format, using current date instead"),t=h)}else console.warn("Could not parse date string, using current date instead.");let n="";if(e.value.coverImageUrl&&e.value.coverImageUrl.startsWith("blob:"))try{const h=await(await fetch(e.value.coverImageUrl)).blob(),y=F(G,`blog-images/${a}-${Date.now()}`);await q(y,h),n=await J(y),console.log("Image uploaded, URL:",n)}catch(c){console.error("Error uploading image:",c),n=e.value.coverImageUrl}else n=e.value.coverImageUrl||"";const v=await K(u,{avatar:e.value.avatarPath,author:e.value.author,formattedDate:e.value.formattedDate||"",date:M.fromDate(t),title:e.value.title,initialHeader:e.value.initialHeader,initialParagraph:e.value.initialParagraph,contentItems:e.value.contentItems,coverImageUrl:n,slug:a});await W(v,{id:v.id}),e.value.id=v.id,console.log("Blog post created with ID:",v.id),console.log("Blog post slug:",a),r.value={show:!0,text:"Blog post published successfully!",color:"success"},setTimeout(()=>{p.push(`/blog/${a}`)},1500),setTimeout(()=>{p.replace(`/blog/${a}`).catch(c=>{console.error("Navigation failed:",c)})},3e3)}catch(t){console.error("Error publishing blog post:",t),r.value={show:!0,text:`Publishing failed: ${t.messages}`,color:"error"}}finally{_.value=!1}};return(u,a)=>(d(),g(D,null,[l($,{class:"header-section",style:U(k.value)},{default:o(()=>[l(S,{class:"mx-2"},{default:o(()=>[l(R,{class:"align-start"},{default:o(()=>[l(T,{class:""},{default:o(()=>[i("div",X,[i("h1",Y,s(e.value.title),1),i("h2",Z,s(e.value.formattedDate),1),e.value.avatarPath?(d(),E(L,{key:0,size:"80"},{default:o(()=>[l(H,{src:e.value.avatarPath},null,8,["src"])]),_:1})):f("",!0),i("p",ee,"By: "+s(e.value.author),1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["style"]),l(N,{class:"overlapping-card ma-6",color:"#f4b754"},{default:o(()=>[i("div",ae,[i("h2",null,s(e.value.initialHeader),1),i("p",null,s(e.value.initialParagraph),1),(d(!0),g(D,null,z(e.value.contentItems,(t,n)=>(d(),g("div",{key:n},[t.type==="header"?(d(),g("h2",te,s(t.content),1)):f("",!0),t.type==="paragraph"?(d(),g("p",oe,s(t.content),1)):f("",!0)]))),128))]),l(w,{onClick:V,color:"blue"},{default:o(()=>a[2]||(a[2]=[m("Edit Content")])),_:1}),l(w,{onClick:x,color:"green"},{default:o(()=>a[3]||(a[3]=[m("Publish")])),_:1}),l(Q,{modelValue:r.value.show,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.show=t),color:r.value.color},{actions:o(()=>[l(w,{variant:"text",onClick:a[0]||(a[0]=t=>r.value.show=!1)},{default:o(()=>a[4]||(a[4]=[m("Close")])),_:1})]),default:o(()=>[m(s(r.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})],64))}},ie=B(le,[["__scopeId","data-v-3c460b4d"]]);export{ie as default};
