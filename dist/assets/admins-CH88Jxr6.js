var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(a,r,s)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,o=(e,a)=>{for(var r in a||(a={}))l.call(a,r)&&i(e,r,a[r]);if(s)for(var r of s(a))t.call(a,r)&&i(e,r,a[r]);return e},n=(e,a,r)=>new Promise(((s,l)=>{var t=e=>{try{o(r.next(e))}catch(a){l(a)}},i=e=>{try{o(r.throw(e))}catch(a){l(a)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(t,i);o((r=r.apply(e,a)).next())}));import{r as u,b as d,c as m,aq as c,ar as v,as as f,at as p,au as h,av as y,aw as w,a4 as g,a2 as b,a1 as P,q as j,a8 as x,a3 as _,u as D,S as A,a7 as q,a9 as $,ax as O,ay as V,ae as E,ah as U}from"./vendor-jmjPa-rR.js";import{A as k,a as L,D as C}from"./index-CLUvi-Fg.js";import{u as F}from"./vue-core-A39zOKqT.js";import{a as I,t as S,w as R,n as T,o as B,x as N,g as G,F as Y}from"./vuetify-Bd3bXPJ0.js";/* empty css              */const z=[{registering:{"auth/email-already-in-use":"An account with this email already exists","auth/invalid-email":"Please provide a valid email address","auth/operation-not-allowed":"Registration is currently disabled","auth/weak-password":"Password should be at least 6 characters"},loggingIn:{"auth/invalid-email":"Please provide a valid email address","auth/user-disabled":"User account has been disabled","auth/operation-not-found":"No user found with this email","auth/wrong-password":"Password is invalid","auth/too-many-requests":"Access temporarily blocked due to many failed login attemps","auth/operation-not-allowed":"Email/password accounts are not enabled in Firebase Console","auth/invalid-login-credentials":"Generic error for invalid credentials","auth/network-request-failed":"Network connectivity issues","auth/internal-error":"Firebase internal error"}}],H={style:{width:"350px"}},J={style:{width:"350px"}},K={__name:"admins",setup(e){const s=L(),{formData:l,showPassword:t,v$:i}=function(){const e=u(!1),s=u(!1),l=d({name:"",email:"",password:"",confirmPassword:""}),t=m((()=>{return{formData:o((e=o({},s.value&&{name:{required:v,minLength:f(4)}}),t={email:{required:v,email:p},password:{required:v,minLength:f(6)}},a(e,r(t))),s.value&&{confirmPassword:{required:v,sameAsPassword:c(l.password)}})};var e,t})),i=h(t,{formData:l});return{formData:l,showPassword:e,v$:i,resetForm:()=>{l.email="",l.password="",s.value&&(l.name="",l.confirmPassword="")},isRegistering:s}}(),{loginUser:K}=function(){return{registerUser:(e,a)=>n(this,null,(function*(){try{return{user:(yield w(k,e,a)).user,error:null}}catch(r){return{user:null,error:{code:r.code,message:r.message}}}})),loginUser:(e,a)=>n(this,null,(function*(){try{return{user:(yield y(k,e,a)).user,error:null}}catch(r){return{user:null,error:{code:r.code,message:r.message}}}}))}}(),M=F(),Q=u(!1),W=u("error"),X=u(""),Z=u(!1),ee=()=>{re()},ae=(e,a=3)=>n(this,null,(function*(){for(let s=0;s<a;s++)try{const a=O(C,"admins","config"),r=yield V(a);if(r.exists())return{isAdmin:r.data().adminEmail===e,adminData:r.data()};const s=E(C,"admins"),l=yield U(s);let t=!1;return l.forEach((a=>{if(a.data().email===e||a.data().adminEmail&&a.data().adminEmail===e)return t=!0,{isAdmin:!0,adminData:a.data()}})),t?{isAdmin:!0,adminData:{email:e}}:{isAdmin:!1}}catch(r){if(s===a-1)throw r;yield new Promise((e=>setTimeout(e,1e3)))}return{isAdmin:!1}})),re=()=>n(this,null,(function*(){var e;if(yield i.value.$validate())try{const{user:a,error:r}=yield K(l.email,l.password);if(r)return W.value="error",X.value=(e=r.code,z.loggingIn[e]||"Log in failed. Please try again."),void(Q.value=!0);const{isAdmin:t,adminData:i}=yield ae(a.email);t?(s.setUserDetails(o({email:a.email,uid:a.uid,isAdmin:!0},i)),W.value="success",Q.value=!0,Z.value=!0,X.value="Login successful! Redirecting...",setTimeout((()=>{M.replace("/").catch((e=>{}))}),3e3)):(yield $(k),W.value="error",X.value="You do not have admin access",Q.value=!0)}catch(a){W.value="error",X.value=`Error: ${a.message}`,Q.value=!0}}));return(e,a)=>(P(),g(I,{theme:"mainTheme"},{default:b((()=>[j(S,{color:"#f4b754",class:"pa-4"},{default:b((()=>[j(R,{onSubmit:x(ee,["prevent"])},{default:b((()=>[j(T,{justify:"center",class:"text-center"},{default:b((()=>[j(B,{cols:"12",md:"12"},{default:b((()=>[a[8]||(a[8]=_("h1",null,"Admin Login",-1)),j(T,{justify:"center"},{default:b((()=>[j(B,{cols:"12",class:"d-flex justify-center"},{default:b((()=>{var e,r,s;return[_("div",H,[j(N,{modelValue:D(l).email,"onUpdate:modelValue":a[0]||(a[0]=e=>D(l).email=e),"error-messages":(null==(s=null==(r=null==(e=D(i))?void 0:e.formData)?void 0:r.email.$errors)?void 0:s.map((e=>e.$message)))||[],label:"Email",required:"",onBlur:a[1]||(a[1]=e=>{var a,r,s;return null==(s=null==(r=null==(a=D(i))?void 0:a.formData)?void 0:r.email)?void 0:s.$touch()}),"prepend-icon":"mdi-mail"},null,8,["modelValue","error-messages"])])]})),_:1})])),_:1}),j(T,{justify:"center"},{default:b((()=>[j(B,{cols:"12",class:"d-flex justify-center"},{default:b((()=>{var e,r,s;return[_("div",J,[j(N,{modelValue:D(l).password,"onUpdate:modelValue":a[2]||(a[2]=e=>D(l).password=e),type:D(t)?"text":"password","error-messages":(null==(s=null==(r=null==(e=D(i))?void 0:e.formData)?void 0:r.password.$errors)?void 0:s.map((e=>e.$message)))||[],label:"Password",required:"",onBlur:a[3]||(a[3]=e=>{var a,r,s;return null==(s=null==(r=null==(a=D(i))?void 0:a.formData)?void 0:r.password)?void 0:s.$touch()}),"prepend-icon":"mdi-lock","append-icon":D(t)?"mdi-eye":"mdi-eye-off","onClick:append":a[4]||(a[4]=e=>t.value=!D(t))},null,8,["modelValue","type","error-messages","append-icon"])])]})),_:1})])),_:1}),j(T,{class:"text-center"},{default:b((()=>[j(B,null,{default:b((()=>[j(G,{type:"submit",color:"blue"},{default:b((()=>a[7]||(a[7]=[A("Sign In")]))),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),j(Y,{modelValue:Q.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Q.value=e),color:W.value,timeout:"3000",location:"top"},{actions:b((()=>[j(G,{color:"white",variant:"text",onClick:a[5]||(a[5]=e=>Q.value=!1)},{default:b((()=>a[9]||(a[9]=[A(" Close ")]))),_:1})])),default:b((()=>[A(q(X.value)+" ",1)])),_:1},8,["modelValue","color"])])),_:1}))}};export{K as default};
