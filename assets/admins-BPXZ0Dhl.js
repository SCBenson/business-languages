import{bH as Re,r as A,bI as Ee,a4 as k,bJ as J,bK as q,bq as Oe,D as y,u as i,bL as Ae,bM as Pe,b5 as X,b2 as ee,aa as te,bN as Ve,bO as K,bP as Ce,bQ as je,q as _e,w as P,e as De,f as Le,b as V,m as Se,bR as Te,g as I,h as F,d as G,n as re,j as ne,i as W,k as ke,t as Ie,O as Fe,bS as ze,bT as Ne,K as ae,bU as Ue,J as qe,N as Be}from"./index-DNCe_cCi.js";import{V as Me}from"./VSnackbar-ZzpTCICS.js";function se(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,t)}return r}function L(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?se(Object(r),!0).forEach(function(t){Ge(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ge(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function oe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(e).reduce((r,t)=>(n.includes(t)||(r[t]=i(e[t])),r),{})}function U(e){return typeof e=="function"}function We(e){return Ae(e)||Pe(e)}function fe(e,n,r){let t=e;const s=n.split(".");for(let l=0;l<s.length;l++){if(!t[s[l]])return r;t=t[s[l]]}return t}function H(e,n,r){return y(()=>e.some(t=>fe(n,t,{[r]:!1})[r]))}function ie(e,n,r){return y(()=>e.reduce((t,s)=>{const l=fe(n,s,{[r]:!1})[r]||[];return t.concat(l)},[]))}function me(e,n,r,t){return e.call(t,i(n),i(r),t)}function ge(e){return e.$valid!==void 0?!e.$valid:!e}function He(e,n,r,t,s,l,h){let{$lazy:c,$rewardEarly:$}=s,o=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],m=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0,w=arguments.length>10?arguments[10]:void 0;const p=A(!!t.value),a=A(0);r.value=!1;const d=k([n,t].concat(o,w),()=>{if(c&&!t.value||$&&!f.value&&!r.value)return;let u;try{u=me(e,n,m,h)}catch(v){u=Promise.reject(v)}a.value++,r.value=!!a.value,p.value=!1,Promise.resolve(u).then(v=>{a.value--,r.value=!!a.value,l.value=v,p.value=ge(v)}).catch(v=>{a.value--,r.value=!!a.value,l.value=v,p.value=!0})},{immediate:!0,deep:typeof n=="object"});return{$invalid:p,$unwatch:d}}function Je(e,n,r,t,s,l,h,c){let{$lazy:$,$rewardEarly:o}=t;const m=()=>({}),f=y(()=>{if($&&!r.value||o&&!c.value)return!1;let w=!0;try{const p=me(e,n,h,l);s.value=p,w=ge(p)}catch(p){s.value=p}return w});return{$unwatch:m,$invalid:f}}function Ke(e,n,r,t,s,l,h,c,$,o,m){const f=A(!1),w=e.$params||{},p=A(null);let a,d;e.$async?{$invalid:a,$unwatch:d}=He(e.$validator,n,f,r,t,p,s,e.$watchTargets,$,o,m):{$invalid:a,$unwatch:d}=Je(e.$validator,n,r,t,p,s,$,o);const u=e.$message;return{$message:U(u)?y(()=>u(oe({$pending:f,$invalid:a,$params:oe(w),$model:n,$response:p,$validator:l,$propertyPath:c,$property:h}))):u||"",$params:w,$pending:f,$invalid:a,$response:p,$unwatch:d}}function Ze(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=i(e),r=Object.keys(n),t={},s={},l={};let h=null;return r.forEach(c=>{const $=n[c];switch(!0){case U($.$validator):t[c]=$;break;case U($):t[c]={$validator:$};break;case c==="$validationGroups":h=$;break;case c.startsWith("$"):l[c]=$;break;default:s[c]=$}}),{rules:t,nestedValidators:s,config:l,validationGroups:h}}const Qe="__root";function Ye(e,n,r,t,s,l,h,c,$){const o=Object.keys(e),m=t.get(s,e),f=A(!1),w=A(!1),p=A(0);if(m){if(!m.$partial)return m;m.$unwatch(),f.value=m.$dirty.value}const a={$dirty:f,$path:s,$touch:()=>{f.value||(f.value=!0)},$reset:()=>{f.value&&(f.value=!1)},$commit:()=>{}};return o.length?(o.forEach(d=>{a[d]=Ke(e[d],n,a.$dirty,l,h,d,r,s,$,w,p)}),a.$externalResults=y(()=>c.value?[].concat(c.value).map((d,u)=>({$propertyPath:s,$property:r,$validator:"$externalResults",$uid:`${s}-externalResult-${u}`,$message:d,$params:{},$response:null,$pending:!1})):[]),a.$invalid=y(()=>{const d=o.some(u=>i(a[u].$invalid));return w.value=d,!!a.$externalResults.value.length||d}),a.$pending=y(()=>o.some(d=>i(a[d].$pending))),a.$error=y(()=>a.$dirty.value?a.$pending.value||a.$invalid.value:!1),a.$silentErrors=y(()=>o.filter(d=>i(a[d].$invalid)).map(d=>{const u=a[d];return q({$propertyPath:s,$property:r,$validator:d,$uid:`${s}-${d}`,$message:u.$message,$params:u.$params,$response:u.$response,$pending:u.$pending})}).concat(a.$externalResults.value)),a.$errors=y(()=>a.$dirty.value?a.$silentErrors.value:[]),a.$unwatch=()=>o.forEach(d=>{a[d].$unwatch()}),a.$commit=()=>{w.value=!0,p.value=Date.now()},t.set(s,e,a),a):(m&&t.set(s,e,a),a)}function Xe(e,n,r,t,s,l,h){const c=Object.keys(e);return c.length?c.reduce(($,o)=>($[o]=Z({validations:e[o],state:n,key:o,parentKey:r,resultsCache:t,globalConfig:s,instance:l,externalResults:h}),$),{}):{}}function et(e,n,r){const t=y(()=>[n,r].filter(a=>a).reduce((a,d)=>a.concat(Object.values(i(d))),[])),s=y({get(){return e.$dirty.value||(t.value.length?t.value.every(a=>a.$dirty):!1)},set(a){e.$dirty.value=a}}),l=y(()=>{const a=i(e.$silentErrors)||[],d=t.value.filter(u=>(i(u).$silentErrors||[]).length).reduce((u,v)=>u.concat(...v.$silentErrors),[]);return a.concat(d)}),h=y(()=>{const a=i(e.$errors)||[],d=t.value.filter(u=>(i(u).$errors||[]).length).reduce((u,v)=>u.concat(...v.$errors),[]);return a.concat(d)}),c=y(()=>t.value.some(a=>a.$invalid)||i(e.$invalid)||!1),$=y(()=>t.value.some(a=>i(a.$pending))||i(e.$pending)||!1),o=y(()=>t.value.some(a=>a.$dirty)||t.value.some(a=>a.$anyDirty)||s.value),m=y(()=>s.value?$.value||c.value:!1),f=()=>{e.$touch(),t.value.forEach(a=>{a.$touch()})},w=()=>{e.$commit(),t.value.forEach(a=>{a.$commit()})},p=()=>{e.$reset(),t.value.forEach(a=>{a.$reset()})};return t.value.length&&t.value.every(a=>a.$dirty)&&f(),{$dirty:s,$errors:h,$invalid:c,$anyDirty:o,$error:m,$pending:$,$touch:f,$reset:p,$silentErrors:l,$commit:w}}function Z(e){let{validations:n,state:r,key:t,parentKey:s,childResults:l,resultsCache:h,globalConfig:c={},instance:$,externalResults:o}=e;const m=s?`${s}.${t}`:t,{rules:f,nestedValidators:w,config:p,validationGroups:a}=Ze(n),d=L(L({},c),p),u=t?y(()=>{const x=i(r);return x?i(x[t]):void 0}):r,v=L({},i(o)||{}),g=y(()=>{const x=i(o);return t?x?i(x[t]):void 0:x}),R=Ye(f,u,t,h,m,d,$,g,r),b=Xe(w,u,m,h,d,$,g),E={};a&&Object.entries(a).forEach(x=>{let[S,D]=x;E[S]={$invalid:H(D,b,"$invalid"),$error:H(D,b,"$error"),$pending:H(D,b,"$pending"),$errors:ie(D,b,"$errors"),$silentErrors:ie(D,b,"$silentErrors")}});const{$dirty:O,$errors:_,$invalid:j,$anyDirty:C,$error:ve,$pending:B,$touch:M,$reset:pe,$silentErrors:he,$commit:Y}=et(R,b,l),ye=t?y({get:()=>i(u),set:x=>{O.value=!0;const S=i(r),D=i(o);D&&(D[t]=v[t]),J(S[t])?S[t].value=x:S[t]=x}}):null;t&&d.$autoDirty&&k(u,()=>{O.value||M();const x=i(o);x&&(x[t]=v[t])},{flush:"sync"});async function we(){return M(),d.$rewardEarly&&(Y(),await te()),await te(),new Promise(x=>{if(!B.value)return x(!j.value);const S=k(B,()=>{x(!j.value),S()})})}function be(x){return(l.value||{})[x]}function xe(){J(o)?o.value=v:Object.keys(v).length===0?Object.keys(o).forEach(x=>{delete o[x]}):Object.assign(o,v)}return q(L(L(L({},R),{},{$model:ye,$dirty:O,$error:ve,$errors:_,$invalid:j,$anyDirty:C,$pending:B,$touch:M,$reset:pe,$path:m||Qe,$silentErrors:he,$validate:we,$commit:Y},l&&{$getResultsForChild:be,$clearExternalResults:xe,$validationGroups:E}),b))}class tt{constructor(){this.storage=new Map}set(n,r,t){this.storage.set(n,{rules:r,result:t})}checkRulesValidity(n,r,t){const s=Object.keys(t),l=Object.keys(r);return l.length!==s.length||!l.every(c=>s.includes(c))?!1:l.every(c=>r[c].$params?Object.keys(r[c].$params).every($=>i(t[c].$params[$])===i(r[c].$params[$])):!0)}get(n,r){const t=this.storage.get(n);if(!t)return;const{rules:s,result:l}=t,h=this.checkRulesValidity(n,r,s),c=l.$unwatch?l.$unwatch:()=>({});return h?l:{$dirty:l.$dirty,$partial:!0,$unwatch:c}}}const N={COLLECT_ALL:!0,COLLECT_NONE:!1},le=Symbol("vuelidate#injectChildResults"),ue=Symbol("vuelidate#removeChildResults");function rt(e){let{$scope:n,instance:r}=e;const t={},s=A([]),l=y(()=>s.value.reduce((m,f)=>(m[f]=i(t[f]),m),{}));function h(m,f){let{$registerAs:w,$scope:p,$stopPropagation:a}=f;a||n===N.COLLECT_NONE||p===N.COLLECT_NONE||n!==N.COLLECT_ALL&&n!==p||(t[w]=m,s.value.push(w))}r.__vuelidateInjectInstances=[].concat(r.__vuelidateInjectInstances||[],h);function c(m){s.value=s.value.filter(f=>f!==m),delete t[m]}r.__vuelidateRemoveInstances=[].concat(r.__vuelidateRemoveInstances||[],c);const $=X(le,[]);ee(le,r.__vuelidateInjectInstances);const o=X(ue,[]);return ee(ue,r.__vuelidateRemoveInstances),{childResults:l,sendValidationResultsToParent:$,removeValidationResultsFromParent:o}}function $e(e){return new Proxy(e,{get(n,r){return typeof n[r]=="object"?$e(n[r]):y(()=>n[r])}})}let ce=0;function nt(e,n){var r;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};arguments.length===1&&(t=e,e=void 0,n=void 0);let{$registerAs:s,$scope:l=N.COLLECT_ALL,$stopPropagation:h,$externalResults:c,currentVueInstance:$}=t;const o=$||((r=Re())===null||r===void 0?void 0:r.proxy),m=o?o.$options:{};s||(ce+=1,s=`_vuelidate_${ce}`);const f=A({}),w=new tt,{childResults:p,sendValidationResultsToParent:a,removeValidationResultsFromParent:d}=o?rt({$scope:l,instance:o}):{childResults:A({})};if(!e&&m.validations){const u=m.validations;n=A({}),Ee(()=>{n.value=o,k(()=>U(u)?u.call(n.value,new $e(n.value)):u,v=>{f.value=Z({validations:v,state:n,childResults:p,resultsCache:w,globalConfig:t,instance:o,externalResults:c||o.vuelidateExternalResults})},{immediate:!0})}),t=m.validationsConfig||t}else{const u=J(e)||We(e)?e:q(e||{});k(u,v=>{f.value=Z({validations:v,state:n,childResults:p,resultsCache:w,globalConfig:t,instance:o??{},externalResults:c})},{immediate:!0})}return o&&(a.forEach(u=>u(f,{$registerAs:s,$scope:l,$stopPropagation:h})),Oe(()=>d.forEach(u=>u(s)))),y(()=>L(L({},i(f.value)),p.value))}const Q=e=>{if(e=i(e),Array.isArray(e))return!!e.length;if(e==null)return!1;if(e===!1)return!0;if(e instanceof Date)return!isNaN(e.getTime());if(typeof e=="object"){for(let n in e)return!0;return!1}return!!String(e).length},at=e=>(e=i(e),Array.isArray(e)?e.length:typeof e=="object"?Object.keys(e).length:String(e).length);function T(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=>(t=i(t),!Q(t)||n.every(s=>(s.lastIndex=0,s.test(t))))}T(/^[a-zA-Z]*$/);T(/^[a-zA-Z0-9]*$/);T(/^\d*(\.\d+)?$/);const st=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;var ot=T(st),it={$validator:ot,$message:"Value is not a valid email address",$params:{type:"email"}};function lt(e){return n=>!Q(n)||at(n)>=i(e)}function de(e){return{$validator:lt(e),$message:n=>{let{$params:r}=n;return`This field should be at least ${r.min} characters long`},$params:{min:e,type:"minLength"}}}function ut(e){return typeof e=="string"&&(e=e.trim()),Q(e)}var z={$validator:ut,$message:"Value is required",$params:{type:"required"}};function ct(e){return n=>i(n)===i(e)}function dt(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"other";return{$validator:ct(e),$message:r=>`The value must be equal to the ${n} value`,$params:{equalTo:e,otherName:n,type:"sameAs"}}}const ft=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;T(ft);T(/(^[0-9]*$)|(^-[0-9]+$)/);T(/^[-]?\d*(\.\d+)?$/);function mt(){const e=A(!1),n=A(!1),r=q({name:"",email:"",password:"",confirmPassword:""}),t=y(()=>({formData:{...n.value&&{name:{required:z,minLength:de(4)}},email:{required:z,email:it},password:{required:z,minLength:de(6)},...n.value&&{confirmPassword:{required:z,sameAsPassword:dt(r.password)}}}})),s=nt(t,{formData:r});return{formData:r,showPassword:e,v$:s,resetForm:()=>{r.email="",r.password="",n.value&&(r.name="",r.confirmPassword="")},isRegistering:n}}function gt(){return{registerUser:async(r,t)=>{try{return{user:(await Ve(K,r,t)).user,error:null}}catch(s){return{user:null,error:{code:s.code,message:s.message}}}},loginUser:async(r,t)=>{try{return{user:(await Ce(K,r,t)).user,error:null}}catch(s){return{user:null,error:{code:s.code,message:s.message}}}}}}const $t=[{registering:{"auth/email-already-in-use":"An account with this email already exists","auth/invalid-email":"Please provide a valid email address","auth/operation-not-allowed":"Registration is currently disabled","auth/weak-password":"Password should be at least 6 characters"},loggingIn:{"auth/invalid-email":"Please provide a valid email address","auth/user-disabled":"User account has been disabled","auth/operation-not-found":"No user found with this email","auth/wrong-password":"Password is invalid","auth/too-many-requests":"Access temporarily blocked due to many failed login attemps","auth/operation-not-allowed":"Email/password accounts are not enabled in Firebase Console","auth/invalid-login-credentials":"Generic error for invalid credentials","auth/network-request-failed":"Network connectivity issues","auth/internal-error":"Firebase internal error"}}],vt={style:{width:"350px"}},pt={style:{width:"350px"}},wt={__name:"admins",setup(e){const n=je(),{formData:r,showPassword:t,v$:s,resetForm:l,isRegistering:h}=mt(),{loginUser:c}=gt(),$=Fe(),o=A(!1),m=A("error"),f=A(""),w=A(!1),p=v=>$t.loggingIn[v]||"Log in failed. Please try again.",a=()=>{u()},d=async(v,g=3)=>{for(let R=0;R<g;R++)try{const b=Ne(ae,"admins","config");console.log("Fetching admin config document...");const E=await Ue(b);if(console.log("Admin doc exists:",E.exists()),E.exists())return console.log("Admin email in database:",E.data().adminEmail),console.log("User email:",v),{isAdmin:E.data().adminEmail===v,adminData:E.data()};console.log("Admin config document not found"),console.log("Attempting to list all admin documents...");const O=qe(ae,"admins"),_=await Be(O);console.log("Total admin documents found:",_.size);let j=!1;return _.forEach(C=>{if(console.log(`Document ID: ${C.id}, Data:`,C.data()),C.data().email===v||C.data().adminEmail&&C.data().adminEmail===v)return j=!0,{isAdmin:!0,adminData:C.data()}}),j?{isAdmin:!0,adminData:{email:v}}:{isAdmin:!1}}catch(b){if(console.error(`Admin check attempt ${R+1} failed:`,{code:b.code,message:b.message}),R===g-1)throw b;await new Promise(E=>setTimeout(E,1e3))}return{isAdmin:!1}},u=async()=>{console.log("Login function called");const v=await s.value.$validate();if(console.log("Form validation result:",v),!v){console.log("Form validation failed");return}console.log("Attempting to login user...");try{const{user:g,error:R}=await c(r.email,r.password);if(R){m.value="error",f.value=p(R.code),o.value=!0,console.log("Login failed:",R.message);return}console.log("User authenticated successfully, checking admin status...");const{isAdmin:b,adminData:E}=await d(g.email);b?(n.setUserDetails({email:g.email,uid:g.uid,isAdmin:!0,...E}),m.value="success",o.value=!0,w.value=!0,f.value="Login successful! Redirecting...",console.log("Admin login successful:",g),setTimeout(()=>{$.replace("/").catch(O=>{console.error("Navigation failed:",O)})},3e3)):(console.log("User authenticated but not an admin"),await ze(K),m.value="error",f.value="You do not have admin access",o.value=!0)}catch(g){console.error("Error during login process:",{code:g.code,message:g.message,stack:g.stack}),m.value="error",f.value=`Error: ${g.message}`,o.value=!0}};return(v,g)=>(Le(),_e(De,{theme:"mainTheme"},{default:P(()=>[V(ke,{color:"#f4b754",class:"pa-4"},{default:P(()=>[V(Se,{onSubmit:Te(a,["prevent"])},{default:P(()=>[V(I,{justify:"center",class:"text-center"},{default:P(()=>[V(F,{cols:"12",md:"12"},{default:P(()=>[g[8]||(g[8]=G("h1",null,"Admin Login",-1)),V(I,{justify:"center"},{default:P(()=>[V(F,{cols:"12",class:"d-flex justify-center"},{default:P(()=>{var R,b,E;return[G("div",vt,[V(re,{modelValue:i(r).email,"onUpdate:modelValue":g[0]||(g[0]=O=>i(r).email=O),"error-messages":((E=(b=(R=i(s))==null?void 0:R.formData)==null?void 0:b.email.$errors)==null?void 0:E.map(O=>O.$message))||[],label:"Email",required:"",onBlur:g[1]||(g[1]=O=>{var _,j,C;return(C=(j=(_=i(s))==null?void 0:_.formData)==null?void 0:j.email)==null?void 0:C.$touch()}),"prepend-icon":"mdi-mail"},null,8,["modelValue","error-messages"])])]}),_:1})]),_:1}),V(I,{justify:"center"},{default:P(()=>[V(F,{cols:"12",class:"d-flex justify-center"},{default:P(()=>{var R,b,E;return[G("div",pt,[V(re,{modelValue:i(r).password,"onUpdate:modelValue":g[2]||(g[2]=O=>i(r).password=O),type:i(t)?"text":"password","error-messages":((E=(b=(R=i(s))==null?void 0:R.formData)==null?void 0:b.password.$errors)==null?void 0:E.map(O=>O.$message))||[],label:"Password",required:"",onBlur:g[3]||(g[3]=O=>{var _,j,C;return(C=(j=(_=i(s))==null?void 0:_.formData)==null?void 0:j.password)==null?void 0:C.$touch()}),"prepend-icon":"mdi-lock","append-icon":i(t)?"mdi-eye":"mdi-eye-off","onClick:append":g[4]||(g[4]=O=>t.value=!i(t))},null,8,["modelValue","type","error-messages","append-icon"])])]}),_:1})]),_:1}),V(I,{class:"text-center"},{default:P(()=>[V(F,null,{default:P(()=>[V(ne,{type:"submit",color:"blue"},{default:P(()=>g[7]||(g[7]=[W("Sign In")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),V(Me,{modelValue:o.value,"onUpdate:modelValue":g[6]||(g[6]=R=>o.value=R),color:m.value,timeout:"3000",location:"top"},{actions:P(()=>[V(ne,{color:"white",variant:"text",onClick:g[5]||(g[5]=R=>o.value=!1)},{default:P(()=>g[9]||(g[9]=[W(" Close ")])),_:1})]),default:P(()=>[W(Ie(f.value)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}};export{wt as default};
